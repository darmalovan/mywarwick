@import controllers.admin.PublishNewsItemData
@import views.html._
@import system.RequestContext
@import models.publishing.PermissionScope
@import models.publishing.Publisher
@import org.joda.time.LocalDateTime

@(
    publisher: Publisher,
    form: Form[PublishNewsItemData],
    departmentOptions: Seq[(String, String)],
    categories: Seq[NewsCategory],
    permissionScope: PermissionScope
)(implicit messages: Messages, context: RequestContext)

@implicitFieldConstructor = @{
  b3.horizontal.fieldConstructor("col-md-3", "col-md-9")
}

@common.admin("Create news") {
  <div class="container-fluid">
  @b3.form(action = controllers.admin.routes.NewsController.create(publisher.id, true), 'class -> "split-form", Symbol("data-audience-action") -> controllers.admin.routes.NewsController.audienceSize(publisher.id)) {
    <div class="alert alert-info audience-estimate-container">
      Estimated reach:
      <span class="audience-estimate-value"></span>
    </div>

    <section>
    @admin.news.contentForm(form)
    </section>

    <section>
      @b3.radio(form("item.publishDateSet"),
        Seq(
          "false" -> "Now",
          "true" -> "Select a time"
        ),
        '_label -> "Publish time",
        'value -> false
      )
      @tags.datetimePicker(form("item.publishDate"),
        '_label -> "Publish date",
        '_help -> "You can select a time in the future, and this news item will appear to users after that time",
        'value -> LocalDateTime.now.withSecondOfMinute(0).withMillisOfSecond(0)
      )
    </section>

    <section>
      @tags.audiencePicker(form, "audience", departmentOptions, "news item", permissionScope, allowPublic = true)
    </section>

    <section>
      @tags.categoryPicker(form, "categories", categories, "news item")
      @tags.submitOrCancel("Create", controllers.admin.routes.NewsController.list(publisher.id))
    </section>
  }
  </div>
}
