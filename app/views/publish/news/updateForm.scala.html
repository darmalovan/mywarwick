@import controllers.publish.PublishNewsItemData
@import system.RequestContext
@import views.html._
@import models.publishing.PermissionScope
@import models.publishing.Publisher
@import org.joda.time.LocalDateTime
@import views.html.helper.CSRF

@(
    publisher: Publisher,
    id: String,
    form: Form[PublishNewsItemData],
    departmentOptions: Seq[(String, String)],
    categories: Seq[NewsCategory],
    permissionScope: PermissionScope,
    audience: Audience
)(implicit messages: Messages, context: RequestContext)

@implicitFieldConstructor = @{
  b3.horizontal.fieldConstructor("col-md-3", "col-md-9")
}

@common.admin("Update news") {
  @b3.form(action = controllers.publish.routes.NewsController.update(publisher.id, id, true), 'class -> "split-form", Symbol("data-audience-action") -> controllers.publish.routes.NewsController.audienceInfo(publisher.id)) {
    @context.csrfHelper.formField
    <div class="audience-indicator"></div>

    <div class="split-form__sections">
      <section>
        @tags.audiencePicker(form, "audience", departmentOptions, "news item", permissionScope, allowPublic = true, audience = audience)
        @tags.categoryPicker(form, "categories", categories, "news item")
      </section>

      <section>
        @publish.news.contentForm(form)
      </section>

      <section>
        @b3.radio(form("item.publishDateSet"),
          Seq(
            "false" -> "Now",
            "true" -> "Select a time"
          ),
          '_label -> "Publish time",
          'value -> false
        )
        @tags.datetimePicker(form("item.publishDate"),
          '_label -> "Publish date",
          '_help -> "You can select a time in the future, and this news item will appear to users after that time",
          'value -> LocalDateTime.now.withSecondOfMinute(0).withMillisOfSecond(0)
        )

        @tags.submitOrCancel("Update", controllers.publish.routes.NewsController.list(publisher.id))
      </section>
    </div>
  }
}
